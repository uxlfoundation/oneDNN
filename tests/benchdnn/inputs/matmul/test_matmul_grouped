# Grouped GEMM tests
#
# Format: --grouped=M:<num_groups>:<M_dims> MxK:KxN
# Where M_dims is comma-separated list of M values for each group (sum must equal M)
# The group dimension is inserted automatically into weights (becomes [G,K,N])
#
# Configurations below cover:
# - Data types: f32, bf16, f16
# - Bias: --bia-dt=f32/bf16/f16, --bia_mask=2 (per-expert bias [num_experts, N])
# - Empty groups (M_g = 0)
# - Row-wise (per-token) src scales: --attr-scales=src:per_dim_0
# - Column-wise wei scales: per_ocic:128x1 (grouped along K dimension)

--reset

# Basic correctness - f32
--dt=f32:f32:f32
--batch=shapes_grouped

# Basic correctness - f16
--reset
--dt=f16:f16:f16
--batch=shapes_grouped

# Basic correctness - bf16
--reset
--dt=bf16:bf16:bf16
--batch=shapes_grouped

# Bias + row-wise src scales - f16
--reset
--dt=f16:f16:f16
--bia-dt=f16 --bia_mask=2
--attr-scales=src:per_dim_0
--batch=shapes_grouped

# Bias + row-wise src scales - bf16
--reset
--dt=bf16:bf16:bf16
--bia-dt=bf16 --bia_mask=2
--attr-scales=src:per_dim_0
--batch=shapes_grouped

# Column-wise weight scales - f32
--reset
--dt=f32:f32:f32
--attr-scales=wei:per_dim_1
--batch=shapes_grouped

# Combined src + weight scales - f16
--reset
--dt=f16:f16:f16
--attr-scales=src:per_dim_0+wei:per_dim_1
--batch=shapes_grouped

# Blocked wei scales - u8/s8
--reset
--dt=u8:s4:bf16
--grouped=M:4:8,8,8,8
--attr-scales=wei:per_ocic:bf16:128x1
32x512:512x256

--reset
--dt=s8:s4:bf16
--grouped=M:4:8,8,8,8
--attr-scales=wei:per_ocic:bf16:128x1
32x512:512x256

--reset
--dt=u8:u8:bf16
--grouped=M:4:8,8,8,8
--attr-scales=wei:per_ocic:bf16:128x1
32x512:512x256

# Combined row-wise src + blocked weight scales
--reset
--dt=u8:s4:bf16
--grouped=M:4:8,8,8,8
--attr-scales=src:per_dim_0+wei:per_ocic:bf16:128x1
32x512:512x256

